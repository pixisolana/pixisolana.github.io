<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trait Selector</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
<script src="https://pixisolana.github.io/gifler.js"></script>

    <style>
        /* Existing styles */
        body { 
            font-family: "Silkscreen", sans-serif;
            font-weight: 400;
            font-style: normal;
            text-align: center; 
            background-color: #9ab5ff;
            margin: 0;
            color: #fff;
        }
        .container { 
            position: relative; 
            width: 100%; 
            margin: 0 auto;
        }
        .slider-container { 
            position: relative; 
            width: 90%; 
            margin: 20px auto; 
        }
        .slider { 
            padding-top: 20px;
            padding-bottom: 20px;
            display: flex; 
            justify-content: center;
            width: 100%;
            overflow-x: scroll;
            justify-content: flex-start;
        }
        .slider img {
            cursor: pointer;
            margin: 0 5px;
            padding: 5px;
            border: 2px dashed #fff;
            width: calc(25% - 10px);
        }
        .arrow { 
            display: none; /* Hide arrows */
        }
        /* width */
        .slider::-webkit-scrollbar {
        width: 100px !important;
        }

        /* Track */
        .slider::-webkit-scrollbar-track {
        box-shadow: inset 0 0 2px rgba(255,255,255,0.7) !important;
        }

        /* Handle */
        .slider::-webkit-scrollbar-thumb {
        background: #fff !important;
        height: 5px !important;
        }
        /* Left */
        ::-webkit-scrollbar-button:single-button:horizontal:decrement {
            height: 12px;
            width: 18px;
            background-position: center;
            background-size: contain;
            background-image: url("https://pixisolana.github.io/L_ARROW.png");
            border: 1px solid #fff;
            padding: 0 4px;
            background-repeat: no-repeat;
        }

        /* Right */
        ::-webkit-scrollbar-button:single-button:horizontal:increment {
            height: 12px;
            width: 18px;
            background-position: center;
            background-image: url("https://pixisolana.github.io/R_ARROW.png");
            background-size: contain;
            border: 1px solid #fff;
            padding: 0 4px;
            background-repeat: no-repeat;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        .col-buttons {
            display: flex;
            flex-direction: column;
        }
        .col-buttons button {
            width: 250px;
            margin-left: auto;
            margin-right: auto;
        }
        .slider-container {
            background-color: #7298ff;
            display: flex;
            align-items: center;
            border: 2px dashed #fff;
        }
        .canvas-wrapper {
            background-image: url('https://pixisolana.github.io/PIXI_SCREEN.png');
            height: 320px;
            width: 320px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            align-items: center;
            margin-bottom: -20px;
        }
        .screen-side {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            top: 0px;
    position: sticky;
    z-index: 2;
    background-color: #9ab5ff;
    border-bottom: 1px solid #fff;
    height: 100%;
        }
        @media (min-width: 992px) {
            .canvas-wrapper {
                height: 640px;
                width: 640px;
            }
            .slider img { 
                max-width: 100px; 
                cursor: pointer; 
                margin: 0 15px; 
                padding: 5px;
                border: 2px dashed #fff;
            }
            .screen-side {
                justify-content: flex-start;
                border-bottom: none;
            }
            .slider-container { 
                position: relative; 
                width: 100%; 
                margin: 20px auto; 
            }
        }
        .canvas-wrapper canvas {
            width: 46.8%;
            height: 46.8%;
            margin: 0 auto;
        }
        .arrow {
            width: 25px;
            height: 39px;
        }
        @media (min-width: 1200px) {
            .container, .container-lg, .container-md, .container-sm, .container-xl {
                max-width: 1400px;
            }
        }
        h1 {
            font-size: 32px;
            margin-bottom: 40px;
            margin-top: 30px;
        }
        @media (min-width: 992px) {
            h1 {
                font-size: 64px;
                margin-bottom: 40px;
                margin-top: 30px;
            }
        }
        .col-buttons button {
            color: #000 !important;
            font-family: 'Silkscreen' !important;
        }
        .small-info {
            font-size: 0.8rem;
            margin-bottom: 10px;
        }
        .petsCover {
            display: none;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            content: '';
            background-color: rgba(0,0,0,.15);
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-lg-6 screen-side">
            <div class="canvas-wrapper" id="canvas-container">
                <canvas id="canvas" width="300" height="300"></canvas>
            </div>
            <div class="col-buttons">
                <button type="button" onclick="downloadPFP()">Download Pixi</button>
                <button type="button" onclick="resetPFP()">Reset</button>
                <button type="button" onclick="randomPFP()">Random</button>
                <button type="button" onclick="uploadBG()">Upload Background</button>
                <div class="small-info">(Recommended 1080px x 1080px)</div>
            </div>
        </div>
        <div class="col-lg-6 mt-3">
            <h3>Background</h3>
            <div id="background-slider-container" class="slider-container">
                <div id="background-slider" class="slider"></div>
            </div>
            <h3>Skin</h3>
            <div id="skin-slider-container" class="slider-container">
                <div id="skin-slider" class="slider"></div>
            </div>
            <h3>Head</h3>
            <div id="head-slider-container" class="slider-container">
                <div id="head-slider" class="slider"></div>
            </div>
            <h3>Clothes</h3>
            <div id="clothes-slider-container" class="slider-container">
                <div id="clothes-slider" class="slider"></div>
            </div>
            <h3>Eyes</h3>
            <div id="eyes-slider-container" class="slider-container">
                <div id="eyes-slider" class="slider"></div>
            </div>
            <h3>Mouth</h3>
            <div id="mouth-slider-container" class="slider-container">
                <div id="mouth-slider" class="slider"></div>
            </div>
            <h3>Hand</h3>
            <div id="hand-slider-container" class="slider-container">
                <div id="hand-slider" class="slider"></div>
            </div>
            <h3>Pets</h3>
            <div id="pets-slider-container" class="slider-container">
                <div class="petsCover"></div>
                <div id="pets-slider" class="slider"></div>
            </div>
        </div>
    </div>
</div>

<canvas id="hiddenCanvas" width="1080" height="1080" style="display:none;"></canvas>

<script>
    const directoryContents = {
        "background": [
            "https://pixisolana.github.io/pixi-gen-052624/background/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/background/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/background/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/background/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/background/4.png",
            "https://pixisolana.github.io/pixi-gen-052624/background/5.png"
        ],
        "clothes": [
            "https://pixisolana.github.io/pixi-gen-052624/clothes/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/4.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/5.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/6.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/7.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/8.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/9.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/10.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/11.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/12.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/13.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/14.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/15.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/16.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/17.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/18.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/19.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/20.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/21.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/22.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/23.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/24.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/25.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/26.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/27.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/28.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/29.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/30.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/31.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/32.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/33.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/34.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/35.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/36.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/37.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/38.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/39.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/40.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/41.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/42.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/43.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/44.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/45.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/46.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/47.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/48.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/49.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/50.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/51.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/52.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/53.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/54.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/55.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/56.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/57.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/58.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/59.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/60.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/61.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/62.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/63.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/64.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/65.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/66.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/67.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/68.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/69.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/70.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/71.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/72.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/73.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/74.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/75.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/76.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/77.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/78.png"
        ],
        "eyes": [
            "https://pixisolana.github.io/pixi-gen-052624/eyes/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/4.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/5.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/6.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/7.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/8.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/9.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/10.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/11.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/12.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/13.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/14.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/15.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/16.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/17.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/18.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/19.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/20.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/21.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/22.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/23.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/24.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/25.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/26.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/27.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/28.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/29.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/30.png"
        ],
        "hand": [
            "https://pixisolana.github.io/pixi-gen-052624/hand/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/4.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/5.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/6.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/7.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/8.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/9.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/10.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/11.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/12.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/13.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/14.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/15.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/16.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/17.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/18.png"
        ],
        "head": [
            "https://pixisolana.github.io/pixi-gen-052624/head/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/5.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/6.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/7.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/8.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/9.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/10.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/11.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/12.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/13.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/14.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/15.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/16.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/17.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/18.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/19.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/20.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/21.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/22.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/23.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/24.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/25.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/26.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/27.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/28.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/29.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/30.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/31.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/33.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/34.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/35.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/36.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/37.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/38.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/39.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/40.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/41.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/42.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/43.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/44.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/45.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/46.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/47.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/48.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/49.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/50.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/51.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/52.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/53.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/54.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/55.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/56.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/57.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/58.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/59.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/60.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/61.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/62.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/63.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/64.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/65.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/66.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/67.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/68.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/69.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/70.png"
        ],
        "mouth": [
            "https://pixisolana.github.io/pixi-gen-052624/mouth/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/4.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/5.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/6.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/7.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/8.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/9.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/10.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/11.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/12.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/13.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/14.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/15.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/16.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/17.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/18.png"
        ],
        "skin": [
            "https://pixisolana.github.io/pixi-gen-052624/skin/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/0xcross skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/agne skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/artchick skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/base skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/bear-skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/bobby skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/cat-skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/erik stevans skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/leonardo dicrypto skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/mrpunk skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/optimus skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/patty-skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/pikachu-skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/spliffy-skin.png"
        ],
        "pets": [
            "https://pixisolana.github.io/pixi-gen-052624/pets/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/pets/cat.gif",
            "https://pixisolana.github.io/pixi-gen-052624/pets/gorilla.gif",
            "https://pixisolana.github.io/pixi-gen-052624/pets/dragon.gif",
            "https://pixisolana.github.io/pixi-gen-052624/pets/nubcat.gif",
            "https://pixisolana.github.io/pixi-gen-052624/pets/shiba.gif",
            "https://pixisolana.github.io/pixi-gen-052624/pets/snake.gif"
        ]
    };

    let selectedTraits = {
        background: "https://pixisolana.github.io/pixi-gen-052624/background/1.png",
        skin: "https://pixisolana.github.io/pixi-gen-052624/skin/base skin.png",
        head: "",
        clothes: "",
        eyes: "",
        mouth: "",
        hand: "",
        pets: ""
    };

    let sliderIndices = {
        background: 0,
        skin: 0,
        head: 0,
        clothes: 0,
        eyes: 0,
        mouth: 0,
        hand: 0,
        pets: 0
    };

    let isPeekAnimating = false;
    let peekAnimationFrameId;
    let peekAnimationStartTime;

    let isJumpAnimating = false;
    let jumpAnimationFrameId;
    let jumpAnimationStartTime;

    let bufferCanvas = document.createElement('canvas');
    bufferCanvas.width = 300;
    bufferCanvas.height = 300;
    let bufferContext = bufferCanvas.getContext('2d');


    let currentGif = null;
let animationFrameId = null;
let animationHandler = null;
let currentGifInstance = null;
let animationRunning = false; // Flag to indicate if an animation is running

// The content of your worker script (gif.worker.js) as a string
const workerScriptContent = `
        // Include the content of gif.worker.js here
        self.onmessage = function(event) {
            // Your worker code...
        };
    `;

    // Create a Blob from the worker script content
    const blob = new Blob([workerScriptContent], { type: 'application/javascript' });

    // Create a URL for the Blob
    const workerBlobUrl = URL.createObjectURL(blob);

    // Create the Web Worker using the Blob URL
    const gifWorker = new Worker(workerBlobUrl);

    // Use gifWorker as needed in your code


    
    function createSlider(sliderId, options, category) {
        const slider = document.getElementById(sliderId);
        if (!options) {
            return;
        }
        options.forEach(option => {
            const img = document.createElement('img');
            img.src = `${option}`;
            img.alt = option.replace('.png', '').replace('.jpg', '').replace('.gif', '');
            img.onclick = () => selectTrait(category, img.src);
            slider.appendChild(img);
        });
    }

    function stopCurrentGif() {
    // Cancel any ongoing animation frames
    if (animationFrameId) {
        console.log('Canceling animation frame:', animationFrameId);
        cancelAnimationFrame(animationFrameId);
        animationFrameId = null;
    }

    // Clear the current GIF instance
    if (currentGifInstance) {
        console.log('Stopping current GIF instance:', currentGifInstance);
        currentGifInstance = null;
    }

    // Reset the canvas and get the new context
    const context = resetCanvas();

    // Update the context with the buffered canvas contents
    context.drawImage(bufferCanvas, 0, 0);

    // Set animationRunning to false to stop any ongoing animations
    animationRunning = false;

    return context; // Return the new context
}


function clearCanvas() {
    const canvas = document.getElementById('canvas');
    const context = canvas.getContext('2d');
    context.clearRect(0, 0, canvas.width, canvas.height); // Clear the entire canvas
}


function selectTrait(category, src) {
        if (category === 'pets') {
            console.log('Stopping current GIF for pets and resetting canvas...');
            stopCurrentGif(); // Stop the current GIF and reset the canvas

            // Get the petsCover element
            const petsCover = document.querySelector('.petsCover');

            if (petsCover) {
                // Show the petsCover element
                petsCover.style.display = 'block';

                // Hide the petsCover element after 1 second
                setTimeout(() => {
                    petsCover.style.display = 'none';
                }, 1000);
            }
        }
        
        selectedTraits[category] = src.includes('none.png') ? "" : src;
        updateTraits(); // Update the canvas with the new trait
    }





    function loadImage(src) {
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.src = src;
            img.crossOrigin = "anonymous";
            img.onload = () => resolve(img);
            img.onerror = reject;
        });
    }
    async function updateTraits(offsetY = 0, transform = [1, 0, 0, 1, 0, 0]) {
    const canvas = document.getElementById('canvas');
    const context = canvas.getContext('2d');

    const { background, skin, head, clothes, eyes, mouth, hand, pets } = selectedTraits;

    const images = await Promise.all([
        background ? loadImage(background) : null,
        skin ? loadImage(skin) : null,
        head ? loadImage(head) : null,
        clothes ? loadImage(clothes) : null,
        eyes ? loadImage(eyes) : null,
        mouth ? loadImage(mouth) : null,
        hand ? loadImage(hand) : null
    ]);

    // Clear the buffer canvas
    bufferContext.clearRect(0, 0, bufferCanvas.width, bufferCanvas.height);

    // Draw all non-pet layers to the buffer canvas
    if (images[0]) bufferContext.drawImage(images[0], 0, 0, bufferCanvas.width, bufferCanvas.height);

    bufferContext.save();
    bufferContext.setTransform(...transform);

    for (let i = 1; i < images.length; i++) {
        if (images[i]) {
            bufferContext.drawImage(images[i], 0, offsetY, bufferCanvas.width, bufferCanvas.height);
        }
    }
    bufferContext.restore();

    // Clear the main canvas before drawing
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.drawImage(bufferCanvas, 0, 0);

    // If there is a pet, start the new GIF
    if (pets) {
        console.log('Starting new pet GIF with URL:', pets);

        // Ensure any previous animation is stopped
        stopCurrentGif();

        // Use gifler to handle the GIF animation
        currentGifInstance = gifler(pets).frames(canvas, function (ctx, frame) {
            if (!animationRunning) return; // Stop if animation should not run

            // Clear the main canvas for each frame to avoid overlapping
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Draw the buffered non-pet layers
            ctx.drawImage(bufferCanvas, 0, 0);
            // Draw the current frame of the pet GIF
            ctx.drawImage(frame.buffer, 0, 0, canvas.width, canvas.height);
        });

        // Set the flag to indicate animation is running
        animationRunning = true;

        // Control the animation loop explicitly
        function animate() {
            if (animationRunning) {
                animationFrameId = requestAnimationFrame(animate); // Continue the animation loop
            }
        }

        // Start the animation loop
        animate();
    }
}



function resetCanvas() {
    const canvasContainer = document.getElementById('canvas-container');
    const oldCanvas = document.getElementById('canvas');
    if (oldCanvas) {
        console.log('Removing existing canvas element...');
        canvasContainer.removeChild(oldCanvas); // Remove the old canvas element
    }
    
    // Create a new canvas element
    const newCanvas = document.createElement('canvas');
    newCanvas.id = 'canvas';
    newCanvas.width = 300;
    newCanvas.height = 300;
    console.log('Creating and appending new canvas element...');
    canvasContainer.appendChild(newCanvas); // Append the new canvas element

    // Reinitialize the canvas context with `willReadFrequently`
    return newCanvas.getContext('2d', { willReadFrequently: true });
}

async function updateHiddenCanvas() {
        const canvas = document.getElementById('hiddenCanvas');
        const context = canvas.getContext('2d');

        const { background, skin, head, clothes, eyes, mouth, hand, pets } = selectedTraits;

        const images = await Promise.all([
            background ? loadImage(background) : null,
            skin ? loadImage(skin) : null,
            head ? loadImage(head) : null,
            clothes ? loadImage(clothes) : null,
            eyes ? loadImage(eyes) : null,
            mouth ? loadImage(mouth) : null,
            hand ? loadImage(hand) : null
        ]);

        context.clearRect(0, 0, canvas.width, canvas.height);

        images.forEach(img => {
            if (img) {
                context.drawImage(img, 0, 0, canvas.width, canvas.height);
            }
        });

        if (pets) {
            gifler(pets).frames(canvas, function (ctx, frame) {
                updateHiddenCanvas();
                ctx.drawImage(frame.buffer, 0, 0, canvas.width, canvas.height);
            });
        }
    }

    function startPeekAnimation() {
        if (isPeekAnimating) return;
        isPeekAnimating = true;
        peekAnimationStartTime = null;
        requestAnimationFrame(peekAnimate);
    }

    function stopPeekAnimation() {
        if (!isPeekAnimating) return;
        isPeekAnimating = false;
        cancelAnimationFrame(peekAnimationFrameId);
    }

    function peekAnimate(timestamp) {
        if (!peekAnimationStartTime) peekAnimationStartTime = timestamp;

        if (typeof timestamp !== 'number') {
            stopPeekAnimation();
            return;
        }

        const duration = 4000;  // Duration of the animation in milliseconds
        const elapsed = timestamp - peekAnimationStartTime;

        if (typeof elapsed !== 'number' || elapsed < 0) {
            stopPeekAnimation();
            return;
        }

        const progress = elapsed / duration;

        const startX = -document.getElementById('canvas').width;
        const startY = document.getElementById('canvas').height;
        const endX = document.getElementById('canvas').width * 0.5;
        const endY = document.getElementById('canvas').height * -0.70;

        const translateX = startX + (endX - startX) * progress;
        const translateY = startY + (endY - startY) * progress;

        if (isNaN(progress) || isNaN(translateX) || isNaN(translateY)) {
            stopPeekAnimation();
            return;
        }

        const scale = 2.25;
        const rotation = 45 * (Math.PI / 180);
        const cosRot = Math.cos(rotation);
        const sinRot = Math.sin(rotation);

        const transform = [
            scale * cosRot,
            scale * sinRot,
            -scale * sinRot,
            scale * cosRot,
            translateX,
            translateY
        ];

        updateTraits(0, transform);

        if (progress < 1) {
            peekAnimationFrameId = requestAnimationFrame(peekAnimate);
        } else {
            stopPeekAnimation();
        }
    }

    function startJumpAnimation() {
        if (isJumpAnimating) return;
        isJumpAnimating = true;
        jumpAnimationStartTime = null;
        requestAnimationFrame(jumpAnimate);
    }

    function stopJumpAnimation() {
        if (!isJumpAnimating) return;
        isJumpAnimating = false;
        cancelAnimationFrame(jumpAnimationFrameId);
    }

    function jumpAnimate(timestamp) {
        if (!jumpAnimationStartTime) jumpAnimationStartTime = timestamp;

        if (typeof timestamp !== 'number') {
            stopJumpAnimation();
            return;
        }

        const duration = 2000;  // Total duration of the animation in milliseconds (1 second up, 1 second down)
        const halfDuration = duration / 2; // Half duration for the upward and downward movement
        const elapsed = timestamp - jumpAnimationStartTime;

        if (typeof elapsed !== 'number' || elapsed < 0) {
            stopJumpAnimation();
            return;
        }

        const progress = elapsed / halfDuration;
        const height = document.getElementById('canvas').height * 0.10; // 10% of canvas height

        // Ease-out and ease-in function
        const easeOutQuad = t => t * (2 - t);
        const easeInQuad = t => t * t;

        let offsetY;
        if (elapsed < halfDuration) {
            // First half: moving up
            offsetY = easeOutQuad(progress) * height;
        } else {
            // Second half: moving down
            const adjustedProgress = (elapsed - halfDuration) / halfDuration;
            offsetY = height - (easeInQuad(adjustedProgress) * height);
        }

        updateTraits(-offsetY); // Move traits

        if (elapsed < duration) {
            jumpAnimationFrameId = requestAnimationFrame(jumpAnimate);
        } else {
            stopJumpAnimation();
        }
    }

    async function updateTraits(offsetY = 0, transform = [1, 0, 0, 1, 0, 0]) {
    // Reset and get the new canvas context
    const context = stopCurrentGif();

    const { background, skin, head, clothes, eyes, mouth, hand, pets } = selectedTraits;

    const images = await Promise.all([
        background ? loadImage(background) : null,
        skin ? loadImage(skin) : null,
        head ? loadImage(head) : null,
        clothes ? loadImage(clothes) : null,
        eyes ? loadImage(eyes) : null,
        mouth ? loadImage(mouth) : null,
        hand ? loadImage(hand) : null
    ]);

    // Clear the buffer canvas
    bufferContext.clearRect(0, 0, bufferCanvas.width, bufferCanvas.height);

    // Draw all non-pet layers to the buffer canvas
    if (images[0]) bufferContext.drawImage(images[0], 0, 0, bufferCanvas.width, bufferCanvas.height);

    bufferContext.save();
    bufferContext.setTransform(...transform);

    for (let i = 1; i < images.length; i++) {
        if (images[i]) {
            bufferContext.drawImage(images[i], 0, offsetY, bufferCanvas.width, bufferCanvas.height);
        }
    }
    bufferContext.restore();

    // Clear the main canvas before drawing
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.drawImage(bufferCanvas, 0, 0);

    // If there is a pet, start the new GIF
    if (pets) {
        console.log('Starting new pet GIF with URL:', pets);

        // Use gifler to handle the GIF animation
        currentGifInstance = gifler(pets).frames(document.getElementById('canvas'), function (ctx, frame) {
            if (!animationRunning) return; // Stop if animation should not run

            // Clear the main canvas for each frame to avoid overlapping
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Draw the buffered non-pet layers
            ctx.drawImage(bufferCanvas, 0, 0);
            // Draw the current frame of the pet GIF
            ctx.drawImage(frame.buffer, 0, 0, canvas.width, canvas.height);
        });

        // Set the flag to indicate animation is running
        animationRunning = true;
    }
}
async function downloadPFP() {
        const downloadButton = document.querySelector('.col-buttons button:first-child');
        const resetButton = document.querySelector('.col-buttons button:nth-child(2)');
        const randomButton = document.querySelector('.col-buttons button:nth-child(3)');
        const uploadButton = document.querySelector('.col-buttons button:nth-child(4)');
        
        let originalText = downloadButton.textContent;

        function toggleButtons(enable) {
            downloadButton.disabled = !enable;
            resetButton.disabled = !enable;
            randomButton.disabled = !enable;
            uploadButton.disabled = !enable;
        }

        if (!selectedTraits.pets || selectedTraits.pets.includes("none.png")) {
            // No pet selected or selected "none.png", download as PNG
            const hiddenCanvas = document.getElementById('hiddenCanvas');
            const hiddenContext = hiddenCanvas.getContext('2d', { willReadFrequently: true });
            hiddenCanvas.width = 1080;
            hiddenCanvas.height = 1080;

            // Load non-pet traits images at full resolution
            const loadFullResolutionImage = async (src) => {
                return new Promise((resolve, reject) => {
                    if (!src) {
                        resolve(null);
                        return;
                    }
                    const img = new Image();
                    img.crossOrigin = 'anonymous'; // Allow cross-origin images
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = src;
                });
            };

            // Load all non-pet trait images at full resolution
            const nonPetImages = await Promise.all([
                selectedTraits.background ? loadFullResolutionImage(selectedTraits.background) : null,
                selectedTraits.skin ? loadFullResolutionImage(selectedTraits.skin) : null,
                selectedTraits.head ? loadFullResolutionImage(selectedTraits.head) : null,
                selectedTraits.clothes ? loadFullResolutionImage(selectedTraits.clothes) : null,
                selectedTraits.eyes ? loadFullResolutionImage(selectedTraits.eyes) : null,
                selectedTraits.mouth ? loadFullResolutionImage(selectedTraits.mouth) : null,
                selectedTraits.hand ? loadFullResolutionImage(selectedTraits.hand) : null
            ]);

            // Clear the hidden canvas before drawing
            hiddenContext.clearRect(0, 0, hiddenCanvas.width, hiddenCanvas.height);

            // Draw all non-pet layers to the hidden canvas
            nonPetImages.forEach(image => {
                if (image) {
                    hiddenContext.drawImage(image, 0, 0, hiddenCanvas.width, hiddenCanvas.height);
                }
            });

            const link = document.createElement('a');
            link.download = 'PIXI.png';
            link.href = hiddenCanvas.toDataURL();
            link.click();
        } else {
            // Pet is selected, download as GIF
            downloadButton.textContent = "Generating...";
            let dots = 0;
            const loadingInterval = setInterval(() => {
                dots = (dots + 1) % 4;
                downloadButton.textContent = "Generating" + ".".repeat(dots);
            }, 500);

            // Disable buttons during GIF generation
            toggleButtons(false);

            const gif = new GIF({
                workers: 2,
                quality: 10,
                workerScript: fullWorkerUrl, // Use local path to the worker script
                width: 1080, // Set the width to 1080 for full resolution
                height: 1080, // Set the height to 1080 for full resolution
                repeat: 0 // Loop forever
            });

            const hiddenCanvas = document.getElementById('hiddenCanvas');
            const hiddenContext = hiddenCanvas.getContext('2d', { willReadFrequently: true });
            hiddenCanvas.width = 1080;
            hiddenCanvas.height = 1080;

            const loadFullResolutionImage = async (src) => {
                return new Promise((resolve, reject) => {
                    if (!src) {
                        resolve(null);
                        return;
                    }
                    const img = new Image();
                    img.crossOrigin = 'anonymous'; // Allow cross-origin images
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = src;
                });
            };

            const nonPetImages = await Promise.all([
                selectedTraits.background ? loadFullResolutionImage(selectedTraits.background) : null,
                selectedTraits.skin ? loadFullResolutionImage(selectedTraits.skin) : null,
                selectedTraits.head ? loadFullResolutionImage(selectedTraits.head) : null,
                selectedTraits.clothes ? loadFullResolutionImage(selectedTraits.clothes) : null,
                selectedTraits.eyes ? loadFullResolutionImage(selectedTraits.eyes) : null,
                selectedTraits.mouth ? loadFullResolutionImage(selectedTraits.mouth) : null,
                selectedTraits.hand ? loadFullResolutionImage(selectedTraits.hand) : null
            ]);

            let frameCount = 0;
            let frames = [];
            const petFrameCounts = {
                'cat.gif': 38,
                'gorilla.gif': 15,
                'dragon.gif': 57,
                'nubcat.gif': 36,
                'shiba.gif': 49,
                'snake.gif': 38
                // Add other pets here if needed
            };
            const petFileName = selectedTraits.pets.split('/').pop(); // Get the file name from the URL
            const totalFrames = petFrameCounts[petFileName] || 60; // Default to 60 if pet is not in the mapping

            await new Promise((resolve, reject) => {
                gifler(selectedTraits.pets).frames(hiddenCanvas, function (ctx, frame) {
                    if (frame.done) {
                        resolve();
                        return;
                    }

                    if (frameCount < totalFrames) {
                        const frameCanvas = document.createElement('canvas');
                        frameCanvas.width = 1080;
                        frameCanvas.height = 1080;
                        const frameContext = frameCanvas.getContext('2d', { willReadFrequently: true });

                        frameContext.clearRect(0, 0, frameCanvas.width, frameCanvas.height);

                        nonPetImages.forEach(image => {
                            if (image) {
                                frameContext.drawImage(image, 0, 0, frameCanvas.width, frameCanvas.height);
                            }
                        });

                        frameContext.drawImage(frame.buffer, 0, 0, frameCanvas.width, frameCanvas.height);

                        frames.push({ canvas: frameCanvas, delay: 150 });

                        frameCount++;
                    }

                    if (frameCount >= totalFrames) {
                        resolve();
                    }
                });
            });

            frames.forEach(({ canvas, delay }) => {
                gif.addFrame(canvas, { copy: true, delay: 150 });
            });

            gif.on('finished', function (blob) {
                clearInterval(loadingInterval);
                downloadButton.textContent = originalText;

                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'PIXI.gif';
                link.click();

                // Re-enable buttons after GIF is downloaded
                toggleButtons(true);
            });

            gif.render();
        }
    }





    function resetPFP() {
        if (currentGif) {
            currentGif.reset();
            currentGif = null;
        }
        selectedTraits.background = "https://pixisolana.github.io/pixi-gen-052624/background/1.png";
        selectedTraits.skin = "https://pixisolana.github.io/pixi-gen-052624/skin/base skin.png";
        selectedTraits.head = "";
        selectedTraits.clothes = "";
        selectedTraits.eyes = "";
        selectedTraits.mouth = "";
        selectedTraits.hand = "";
        selectedTraits.pets = "";
        updateTraits();
    }

    function randomPFP() {
        if (currentGif) {
            currentGif.reset();
            currentGif = null;
        }
        const getRandomTrait = (category) => {
            const options = directoryContents[category];
            if (!options) {
                return "";
            }
            const randomIndex = Math.floor(Math.random() * options.length);
            return options[randomIndex];
        };

        selectedTraits.background = getRandomTrait('background');
        selectedTraits.skin = getRandomTrait('skin');
        selectedTraits.head = getRandomTrait('head');
        selectedTraits.clothes = getRandomTrait('clothes');
        selectedTraits.eyes = getRandomTrait('eyes');
        selectedTraits.mouth = getRandomTrait('mouth');
        selectedTraits.hand = getRandomTrait('hand');
        selectedTraits.pets = getRandomTrait('pets');

        if (selectedTraits.background === directoryContents.background[0] ||
            selectedTraits.skin === directoryContents.skin[0] ||
            selectedTraits.head === directoryContents.head[0] ||
            selectedTraits.clothes === directoryContents.clothes[0] ||
            selectedTraits.eyes === directoryContents.eyes[0] ||
            selectedTraits.mouth === directoryContents.mouth[0] ||
            selectedTraits.hand === directoryContents.hand[0] ||
            selectedTraits.pets === directoryContents.pets[0]) {
            randomPFP();
        } else {
            updateTraits();
        }
    }

    function uploadBG() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = async (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        const dataURL = canvas.toDataURL();
                        selectedTraits.background = dataURL;
                        updateTraits();
                        const backgroundSlider = document.getElementById('background-slider');
                        const newImg = document.createElement('img');
                        newImg.src = dataURL;
                        newImg.alt = 'Uploaded Background';
                        newImg.onclick = () => selectTrait('background', dataURL);
                        backgroundSlider.insertBefore(newImg, backgroundSlider.children[1]);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        };
        input.click();
    }

    async function downloadJumpAnimation() {
        const canvas = document.getElementById('canvas');
        const gif = new GIF({
            workers: 2,
            quality: 10,
            workerScript: fullWorkerUrl, // Specify the correct path to the worker script
            width: canvas.width,
            height: canvas.height
        });

        const duration = 4000; // Duration of the animation in milliseconds (1.2 seconds)
        const frameRate = 60; // 30 frames per second
        const totalFrames = Math.round(duration / (1000 / frameRate));

        function captureFrame(offsetY) {
            return new Promise(resolve => {
                requestAnimationFrame(async () => {
                    await updateHiddenCanvas(offsetY);
                    gif.addFrame(canvas, { copy: true, delay: 1000 / frameRate });
                    resolve();
                });
            });
        }

        startJumpAnimation();

        for (let i = 0; i < totalFrames; i++) {
            const progress = i / totalFrames;
            const height = canvas.height * 0.10; // 10% of canvas height
            const easeOutQuad = t => t * (2 - t);
            const easeInQuad = t => t * t;

            let offsetY;
            if (i < totalFrames / 2) {
                offsetY = easeOutQuad(progress) * height;
            } else {
                offsetY = height - (easeInQuad((progress - 0.5) * 2) * height);
            }

            await captureFrame(-offsetY);
        }

        stopJumpAnimation();

        gif.on('finished', function (blob) {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'jump-animation.gif';
            link.click();
        });

        gif.render();
    }

    async function downloadPeekAnimation() {
        const canvas = document.getElementById('canvas');
        const gif = new GIF({
            workers: 2,
            quality: 10,
            workerScript: fullWorkerUrl, // Specify the correct path to the worker script
            width: canvas.width,
            height: canvas.height
        });

        const duration = 4000; // Duration of the animation in milliseconds (4 seconds)
        const frameRate = 30; // 30 frames per second
        const totalFrames = Math.round(duration / (1000 / frameRate));

        function captureFrame(transform) {
            return new Promise(resolve => {
                requestAnimationFrame(async () => {
                    await updateHiddenCanvas(0, transform);
                    gif.addFrame(canvas, { copy: true, delay: 1000 / frameRate });
                    resolve();
                });
            });
        }

        startPeekAnimation();

        for (let i = 0; i < totalFrames; i++) {
            const progress = i / totalFrames;
            const startX = -canvas.width;
            const startY = canvas.height;
            const endX = canvas.width * 0.5;
            const endY = canvas.height * -0.70;
            const translateX = startX + (endX - startX) * progress;
            const translateY = startY + (endY - startY) * progress;
            const scale = 2.25;
            const rotation = 45 * (Math.PI / 180);
            const cosRot = Math.cos(rotation);
            const sinRot = Math.sin(rotation);
            const transform = [
                scale * cosRot,
                scale * sinRot,
                -scale * sinRot,
                scale * cosRot,
                translateX,
                translateY
            ];

            await captureFrame(transform);
        }

        stopPeekAnimation();

        gif.on('finished', function (blob) {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'peek-animation.gif';
            link.click();
        });

        gif.render();
    }

    window.onload = () => {
        createSlider('background-slider', directoryContents.background, 'background');
        createSlider('skin-slider', directoryContents.skin, 'skin');
        createSlider('head-slider', directoryContents.head, 'head');
        createSlider('clothes-slider', directoryContents.clothes, 'clothes');
        createSlider('eyes-slider', directoryContents.eyes, 'eyes');
        createSlider('mouth-slider', directoryContents.mouth, 'mouth');
        createSlider('hand-slider', directoryContents.hand, 'hand');
        createSlider('pets-slider', directoryContents.pets, 'pets');

        // Set default selections
        updateTraits();
    };
</script>
</body>
</html>
