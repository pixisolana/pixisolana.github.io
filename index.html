<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trait Selector</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
    <script src="./gif.worker.js"></script>

    
    <style>
        /* Existing styles */
        body { 
            font-family: "Silkscreen", sans-serif;
            font-weight: 400;
            font-style: normal;
            text-align: center; 
            background-color: #9ab5ff;
            margin: 0;
            color: #fff;
        }
        .container { 
            position: relative; 
            width: 100%; 
            margin: 0 auto;
        }
        .slider-container { 
            position: relative; 
            width: 90%; 
            margin: 20px auto; 
        }
        .slider { 
            padding-top: 20px;
            padding-bottom: 20px;
            display: flex; 
            justify-content: center;
            width: 100%;
            overflow-x: scroll;
            justify-content: flex-start;

        }
        .slider img {
            cursor: pointer;
            margin: 0 5px;
            padding: 5px;
            border: 2px dashed #fff;
            width: calc(25% - 10px);
        }
        .arrow { 
            display: none; /* Hide arrows */
        }
        /* width */
        .slider::-webkit-scrollbar {
        width: 100px !important;
        }

        /* Track */
        .slider::-webkit-scrollbar-track {
        box-shadow: inset 0 0 2px rgba(255,255,255,0.7) !important;
        }

        /* Handle */
        .slider::-webkit-scrollbar-thumb {
        background: #fff !important;
        height: 5px !important;
        }
        /* Left */
        ::-webkit-scrollbar-button:single-button:horizontal:decrement {
            height: 12px;
            width: 18px;
            background-position: center;
            background-size: contain;
            background-image: url("https://pixisolana.github.io/L_ARROW.png");
            border: 1px solid #fff;
            padding: 0 4px;
            background-repeat: no-repeat;
        }

        /* Right */
        ::-webkit-scrollbar-button:single-button:horizontal:increment {
            height: 12px;
            width: 18px;
            background-position: center;
            background-image: url("https://pixisolana.github.io/R_ARROW.png");
            background-size: contain;
            border: 1px solid #fff;
            padding: 0 4px;
            background-repeat: no-repeat;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        .col-buttons {
            display: flex;
            flex-direction: column;
        }
        .col-buttons button {
            width: 250px;
            margin-left: auto;
            margin-right: auto;
        }
        .slider-container {
            background-color: #7298ff;
            display: flex;
            align-items: center;
            border: 2px dashed #fff;
        }
        .canvas-wrapper {
            background-image: url('https://pixisolana.github.io/PIXI_SCREEN.png');
            height: 320px;
            width: 320px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            align-items: center;
            margin-bottom: -20px;
        }
        .screen-side {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            top: 0px;
    position: sticky;
    z-index: 2;
    background-color: #9ab5ff;
    border-bottom: 1px solid #fff;
    height: 100%;
        }
        @media (min-width: 992px) {
            .canvas-wrapper {
                height: 640px;
                width: 640px;
            }
            .slider img { 
                max-width: 100px; 
                cursor: pointer; 
                margin: 0 15px; 
                padding: 5px;
                border: 2px dashed #fff;
            }
            .screen-side {
                justify-content: flex-start;
                border-bottom: none;
            }
            .slider-container { 
                position: relative; 
                width: 100%; 
                margin: 20px auto; 
            }
        }
        .canvas-wrapper canvas {
            width: 46.8%;
            height: 46.8%;
            margin: 0 auto;
        }
        .arrow {
            width: 25px;
            height: 39px;
        }
        @media (min-width: 1200px) {
            .container, .container-lg, .container-md, .container-sm, .container-xl {
                max-width: 1400px;
            }
        }
        h1 {
            font-size: 32px;
            margin-bottom: 40px;
            margin-top: 30px;
        }
        @media (min-width: 992px) {
            h1 {
                font-size: 64px;
                margin-bottom: 40px;
                margin-top: 30px;
            }
        }
        .col-buttons button {
            color: #000 !important;
            font-family: 'Silkscreen' !important;
        }
        .small-info {
            font-size: 0.8rem;
            margin-bottom: 10px;
        }
    </style>

</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-lg-6 screen-side">
            <div class="canvas-wrapper">
                <canvas id="canvas" width="300" height="300"></canvas>
            </div>
            <div class="col-buttons">
                <button type="button" onclick="downloadPFP()">Download Pixi</button>
                <button type="button" onclick="resetPFP()">Reset</button>
                <button type="button" onclick="randomPFP()">Random</button>
                <button type="button" onclick="uploadBG()">Upload Background</button>
                <button type="button" onclick="startJumpAnimation()">Jump Animate</button>
                <button type="button" onclick="startPeekAnimation()">Peek Animate</button>


                <button type="button" onclick="downloadJumpAnimation()">Download Jump Animation</button>
                <button type="button" onclick="downloadPeekAnimation()">Download Peek Animation</button>


                <div class="small-info">(Recommended 1080px x 1080px)</div>
            </div>
        </div>
        <div class="col-lg-6 mt-3">
            <h3>Background</h3>
            <div id="background-slider-container" class="slider-container">
                <div id="background-slider" class="slider"></div>
            </div>
            <h3>Skin</h3>
            <div id="skin-slider-container" class="slider-container">
                <div id="skin-slider" class="slider"></div>
            </div>
            <h3>Head</h3>
            <div id="head-slider-container" class="slider-container">
                <div id="head-slider" class="slider"></div>
            </div>
            <h3>Clothes</h3>
            <div id="clothes-slider-container" class="slider-container">
                <div id="clothes-slider" class="slider"></div>
            </div>
            <h3>Eyes</h3>
            <div id="eyes-slider-container" class="slider-container">
                <div id="eyes-slider" class="slider"></div>
            </div>
            <h3>Mouth</h3>
            <div id="mouth-slider-container" class="slider-container">
                <div id="mouth-slider" class="slider"></div>
            </div>
            <h3>Hand</h3>
            <div id="hand-slider-container" class="slider-container">
                <div id="hand-slider" class="slider"></div>
            </div>
        </div>
    </div>
</div>

<canvas id="hiddenCanvas" width="1080" height="1080" style="display:none;"></canvas>

<script>
    const directoryContents = {
        "background": [
            "https://pixisolana.github.io/pixi-gen-052624/background/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/background/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/background/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/background/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/background/4.png",
            "https://pixisolana.github.io/pixi-gen-052624/background/5.png"
        ],
        "clothes": [
            "https://pixisolana.github.io/pixi-gen-052624/clothes/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/4.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/5.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/6.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/7.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/8.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/9.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/10.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/11.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/12.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/13.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/14.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/15.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/16.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/17.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/18.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/19.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/20.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/21.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/22.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/23.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/24.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/25.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/26.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/27.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/28.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/29.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/30.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/31.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/32.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/33.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/34.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/35.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/36.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/37.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/38.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/39.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/40.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/41.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/42.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/43.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/44.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/45.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/46.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/47.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/48.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/49.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/50.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/51.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/52.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/53.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/54.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/55.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/56.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/57.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/58.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/59.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/60.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/61.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/62.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/63.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/64.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/65.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/66.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/67.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/68.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/69.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/70.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/71.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/72.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/73.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/74.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/75.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/76.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/77.png",
            "https://pixisolana.github.io/pixi-gen-052624/clothes/78.png"
        ],
        "eyes": [
            "https://pixisolana.github.io/pixi-gen-052624/eyes/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/4.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/5.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/6.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/7.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/8.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/9.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/10.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/11.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/12.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/13.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/14.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/15.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/16.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/17.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/18.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/19.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/20.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/21.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/22.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/23.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/24.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/25.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/26.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/27.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/28.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/29.png",
            "https://pixisolana.github.io/pixi-gen-052624/eyes/30.png"
        ],
        "hand": [
            "https://pixisolana.github.io/pixi-gen-052624/hand/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/4.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/5.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/6.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/7.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/8.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/9.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/10.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/11.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/12.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/13.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/14.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/15.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/16.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/17.png",
            "https://pixisolana.github.io/pixi-gen-052624/hand/18.png"
        ],
        "head": [
            "https://pixisolana.github.io/pixi-gen-052624/head/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/5.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/6.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/7.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/8.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/9.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/10.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/11.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/12.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/13.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/14.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/15.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/16.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/17.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/18.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/19.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/20.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/21.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/22.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/23.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/24.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/25.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/26.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/27.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/28.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/29.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/30.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/31.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/33.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/34.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/35.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/36.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/37.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/38.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/39.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/40.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/41.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/42.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/43.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/44.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/45.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/46.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/47.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/48.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/49.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/50.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/51.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/52.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/53.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/54.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/55.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/56.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/57.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/58.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/59.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/60.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/61.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/62.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/63.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/64.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/65.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/66.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/67.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/68.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/69.png",
            "https://pixisolana.github.io/pixi-gen-052624/head/70.png"
        ],
        "mouth": [
            "https://pixisolana.github.io/pixi-gen-052624/mouth/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/1.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/2.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/3.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/4.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/5.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/6.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/7.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/8.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/9.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/10.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/11.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/12.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/13.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/14.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/15.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/16.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/17.png",
            "https://pixisolana.github.io/pixi-gen-052624/mouth/18.png"
        ],
        "skin": [
            "https://pixisolana.github.io/pixi-gen-052624/skin/none.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/0xcross skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/agne skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/artchick skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/base skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/bear-skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/bobby skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/cat-skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/erik stevans skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/leonardo dicrypto skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/mrpunk skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/optimus skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/patty-skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/pikachu-skin.png",
            "https://pixisolana.github.io/pixi-gen-052624/skin/spliffy-skin.png"
        ]
    };

    let selectedTraits = {
        background: "https://pixisolana.github.io/pixi-gen-052624/background/1.png",
        skin: "https://pixisolana.github.io/pixi-gen-052624/skin/base skin.png",
        head: "",
        clothes: "",
        eyes: "",
        mouth: "",
        hand: ""
    };

    let sliderIndices = {
        background: 0,
        skin: 0,
        head: 0,
        clothes: 0,
        eyes: 0,
        mouth: 0,
        hand: 0
    };

    let isPeekAnimating = false;
    let peekAnimationFrameId;
    let peekAnimationStartTime;

    let isJumpAnimating = false;
    let jumpAnimationFrameId;
    let jumpAnimationStartTime;

    function createSlider(sliderId, options, category) {
        const slider = document.getElementById(sliderId);
        if (!options) {
            console.error(`Options for category "${category}" are undefined.`);
            return;
        }
        options.forEach(option => {
            const img = document.createElement('img');
            img.src = `${option}`;
            img.alt = option.replace('.png', '').replace('.jpg', '');
            img.onclick = () => selectTrait(category, img.src);
            slider.appendChild(img);
        });
    }

    function selectTrait(category, src) {
        selectedTraits[category] = src.includes('none.png') ? "" : src;
        updateTraits();
    }

    function loadImage(src) {
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.src = src;
            img.crossOrigin = "anonymous";
            img.onload = () => resolve(img);
            img.onerror = reject;
        });
    }

    async function updateTraits(offsetY = 0, transform = [1, 0, 0, 1, 0, 0]) {
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');

        const { background, skin, head, clothes, eyes, mouth, hand } = selectedTraits;

        const images = await Promise.all([
            background ? loadImage(background) : null,
            skin ? loadImage(skin) : null,
            head ? loadImage(head) : null,
            clothes ? loadImage(clothes) : null,
            eyes ? loadImage(eyes) : null,
            mouth ? loadImage(mouth) : null,
            hand ? loadImage(hand) : null
        ]);

        context.clearRect(0, 0, canvas.width, canvas.height);

        if (images[0]) context.drawImage(images[0], 0, 0, canvas.width, canvas.height);

        context.save();
        console.log('Applying transform:', transform);
        context.setTransform(...transform);

        for (let i = 1; i < images.length; i++) {
            if (images[i]) {
                context.drawImage(images[i], 0, offsetY, canvas.width, canvas.height);
            }
        }
        context.restore();
    }

    function startPeekAnimation() {
        if (isPeekAnimating) return;
        isPeekAnimating = true;
        peekAnimationStartTime = null;
        requestAnimationFrame(peekAnimate);
    }

    function stopPeekAnimation() {
        if (!isPeekAnimating) return;
        isPeekAnimating = false;
        cancelAnimationFrame(peekAnimationFrameId);
    }

    function peekAnimate(timestamp) {
        if (!peekAnimationStartTime) peekAnimationStartTime = timestamp;

        if (typeof timestamp !== 'number') {
            console.error('Invalid timestamp:', timestamp);
            stopPeekAnimation();
            return;
        }

        const duration = 4000;  // Duration of the animation in milliseconds
        const elapsed = timestamp - peekAnimationStartTime;

        if (typeof elapsed !== 'number' || elapsed < 0) {
            console.error('Invalid elapsed time:', elapsed);
            stopPeekAnimation();
            return;
        }

        const progress = elapsed / duration;
        console.log('Progress:', progress);

        const startX = -document.getElementById('canvas').width;
        const startY = document.getElementById('canvas').height;
        const endX = document.getElementById('canvas').width * 0.5;
        const endY = document.getElementById('canvas').height * -0.70;

        const translateX = startX + (endX - startX) * progress;
        const translateY = startY + (endY - startY) * progress;

        console.log('TranslateX:', translateX);
        console.log('TranslateY:', translateY);

        if (isNaN(progress) || isNaN(translateX) || isNaN(translateY)) {
            console.error('Invalid transformation parameters:', { translateX, translateY });
            stopPeekAnimation();
            return;
        }

        const scale = 2.25;
        const rotation = 45 * (Math.PI / 180);
        const cosRot = Math.cos(rotation);
        const sinRot = Math.sin(rotation);

        const transform = [
            scale * cosRot,
            scale * sinRot,
            -scale * sinRot,
            scale * cosRot,
            translateX,
            translateY
        ];

        console.log('Transform:', transform);

        updateTraits(0, transform);

        if (progress < 1) {
            peekAnimationFrameId = requestAnimationFrame(peekAnimate);
        } else {
            stopPeekAnimation();
        }
    }

    function startJumpAnimation() {
        if (isJumpAnimating) return;
        isJumpAnimating = true;
        jumpAnimationStartTime = null;
        requestAnimationFrame(jumpAnimate);
    }

    function stopJumpAnimation() {
        if (!isJumpAnimating) return;
        isJumpAnimating = false;
        cancelAnimationFrame(jumpAnimationFrameId);
    }

    function jumpAnimate(timestamp) {
        if (!jumpAnimationStartTime) jumpAnimationStartTime = timestamp;

        if (typeof timestamp !== 'number') {
            console.error('Invalid timestamp:', timestamp);
            stopJumpAnimation();
            return;
        }

        const duration = 2000;  // Total duration of the animation in milliseconds (1 second up, 1 second down)
        const halfDuration = duration / 2; // Half duration for the upward and downward movement
        const elapsed = timestamp - jumpAnimationStartTime;

        if (typeof elapsed !== 'number' || elapsed < 0) {
            console.error('Invalid elapsed time:', elapsed);
            stopJumpAnimation();
            return;
        }

        const progress = elapsed / halfDuration;
        const height = document.getElementById('canvas').height * 0.10; // 10% of canvas height

        // Ease-out and ease-in function
        const easeOutQuad = t => t * (2 - t);
        const easeInQuad = t => t * t;

        let offsetY;
        if (elapsed < halfDuration) {
            // First half: moving up
            offsetY = easeOutQuad(progress) * height;
        } else {
            // Second half: moving down
            const adjustedProgress = (elapsed - halfDuration) / halfDuration;
            offsetY = height - (easeInQuad(adjustedProgress) * height);
        }

        updateTraits(-offsetY); // Move traits

        if (elapsed < duration) {
            jumpAnimationFrameId = requestAnimationFrame(jumpAnimate);
        } else {
            stopJumpAnimation();
        }
    }


    async function updateHiddenCanvas() {
        const canvas = document.getElementById('hiddenCanvas');
        const context = canvas.getContext('2d');

        const { background, skin, head, clothes, eyes, mouth, hand } = selectedTraits;

        const images = await Promise.all([
            background ? loadImage(background) : null,
            skin ? loadImage(skin) : null,
            head ? loadImage(head) : null,
            clothes ? loadImage(clothes) : null,
            eyes ? loadImage(eyes) : null,
            mouth ? loadImage(mouth) : null,
            hand ? loadImage(hand) : null
        ]);

        context.clearRect(0, 0, canvas.width, canvas.height);

        images.forEach(img => {
            if (img) {
                context.drawImage(img, 0, 0, canvas.width, canvas.height);
            }
        });
    }

    async function downloadPFP() {
        await updateHiddenCanvas();

        const canvas = document.getElementById('hiddenCanvas');
        const link = document.createElement('a');
        link.download = 'PIXI.png';
        link.href = canvas.toDataURL();
        link.click();
    }

    function resetPFP() {
        selectedTraits.background = "https://pixisolana.github.io/pixi-gen-052624/background/1.png";
        selectedTraits.skin = "https://pixisolana.github.io/pixi-gen-052624/skin/base skin.png";
        selectedTraits.head = "";
        selectedTraits.clothes = "";
        selectedTraits.eyes = "";
        selectedTraits.mouth = "";
        selectedTraits.hand = "";
        updateTraits();
    }

    function randomPFP() {
        const getRandomTrait = (category) => {
            const options = directoryContents[category];
            if (!options) {
                console.error(`Options for category "${category}" are undefined.`);
                return "";
            }
            const randomIndex = Math.floor(Math.random() * options.length);
            return options[randomIndex];
        };

        selectedTraits.background = getRandomTrait('background');
        selectedTraits.skin = getRandomTrait('skin');
        selectedTraits.head = getRandomTrait('head');
        selectedTraits.clothes = getRandomTrait('clothes');
        selectedTraits.eyes = getRandomTrait('eyes');
        selectedTraits.mouth = getRandomTrait('mouth');
        selectedTraits.hand = getRandomTrait('hand');

        if (selectedTraits.background === directoryContents.background[0] ||
            selectedTraits.skin === directoryContents.skin[0] ||
            selectedTraits.head === directoryContents.head[0] ||
            selectedTraits.clothes === directoryContents.clothes[0] ||
            selectedTraits.eyes === directoryContents.eyes[0] ||
            selectedTraits.mouth === directoryContents.mouth[0] ||
            selectedTraits.hand === directoryContents.hand[0]) {
            randomPFP();
        } else {
            updateTraits();
        }
    }

    function uploadBG() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = async (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        const dataURL = canvas.toDataURL();
                        selectedTraits.background = dataURL;
                        updateTraits();
                        const backgroundSlider = document.getElementById('background-slider');
                        const newImg = document.createElement('img');
                        newImg.src = dataURL;
                        newImg.alt = 'Uploaded Background';
                        newImg.onclick = () => selectTrait('background', dataURL);
                        backgroundSlider.insertBefore(newImg, backgroundSlider.children[1]);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        };
        input.click();
    }

    async function downloadJumpAnimation() {
    const canvas = document.getElementById('canvas');
    const gif = new GIF({
        workers: 2,
        quality: 10,
        workerScript: './gif.worker.js', // Specify the correct path to the worker script
        width: canvas.width,
        height: canvas.height
    });

    const duration = 4000; // Duration of the animation in milliseconds (1.2 seconds)
    const frameRate = 60; // 30 frames per second
    const totalFrames = Math.round(duration / (1000 / frameRate));

    function captureFrame(offsetY) {
        return new Promise(resolve => {
            requestAnimationFrame(async () => {
                await updateHiddenCanvas(offsetY);
                gif.addFrame(canvas, { copy: true, delay: 1000 / frameRate });
                resolve();
            });
        });
    }

    startJumpAnimation();

    for (let i = 0; i < totalFrames; i++) {
        const progress = i / totalFrames;
        const height = canvas.height * 0.10; // 10% of canvas height
        const easeOutQuad = t => t * (2 - t);
        const easeInQuad = t => t * t;

        let offsetY;
        if (i < totalFrames / 2) {
            offsetY = easeOutQuad(progress * 2) * height;
        } else {
            offsetY = height - (easeInQuad((progress - 0.5) * 2) * height);
        }

        await captureFrame(-offsetY);
    }

    stopJumpAnimation();

    gif.on('finished', function (blob) {
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'jump-animation.gif';
        link.click();
    });

    gif.render();
}

async function downloadPeekAnimation() {
    const canvas = document.getElementById('canvas');
    const gif = new GIF({
        workers: 2,
        quality: 10,
        workerScript: './gif.worker.js', // Specify the correct path to the worker script
        width: canvas.width,
        height: canvas.height
    });

    const duration = 4000; // Duration of the animation in milliseconds (4 seconds)
    const frameRate = 30; // 30 frames per second
    const totalFrames = Math.round(duration / (1000 / frameRate));

    function captureFrame(transform) {
        return new Promise(resolve => {
            requestAnimationFrame(async () => {
                await updateHiddenCanvas(0, transform);
                gif.addFrame(canvas, { copy: true, delay: 1000 / frameRate });
                resolve();
            });
        });
    }

    startPeekAnimation();

    for (let i = 0; i < totalFrames; i++) {
        const progress = i / totalFrames;
        const startX = -canvas.width;
        const startY = canvas.height;
        const endX = canvas.width * 0.5;
        const endY = canvas.height * -0.70;
        const translateX = startX + (endX - startX) * progress;
        const translateY = startY + (endY - startY) * progress;
        const scale = 2.25;
        const rotation = 45 * (Math.PI / 180);
        const cosRot = Math.cos(rotation);
        const sinRot = Math.sin(rotation);
        const transform = [
            scale * cosRot,
            scale * sinRot,
            -scale * sinRot,
            scale * cosRot,
            translateX,
            translateY
        ];

        await captureFrame(transform);
    }

    stopPeekAnimation();

    gif.on('finished', function (blob) {
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'peek-animation.gif';
        link.click();
    });

    gif.render();
}



    window.onload = () => {
        createSlider('background-slider', directoryContents.background, 'background');
        createSlider('skin-slider', directoryContents.skin, 'skin');
        createSlider('head-slider', directoryContents.head, 'head');
        createSlider('clothes-slider', directoryContents.clothes, 'clothes');
        createSlider('eyes-slider', directoryContents.eyes, 'eyes');
        createSlider('mouth-slider', directoryContents.mouth, 'mouth');
        createSlider('hand-slider', directoryContents.hand, 'hand');

        // Set default selections
        updateTraits();
    };
</script>



</body>
</html>
